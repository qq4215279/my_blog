{"remainingRequest":"D:\\data\\GoWorkSpace\\src\\github.com.qq4215279\\MyBlog\\frontend\\myblog-backstage\\node_modules\\babel-loader\\lib\\index.js!D:\\data\\GoWorkSpace\\src\\github.com.qq4215279\\MyBlog\\frontend\\myblog-backstage\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\data\\GoWorkSpace\\src\\github.com.qq4215279\\MyBlog\\frontend\\myblog-backstage\\src\\router\\request.js","dependencies":[{"path":"D:\\data\\GoWorkSpace\\src\\github.com.qq4215279\\MyBlog\\frontend\\myblog-backstage\\src\\router\\request.js","mtime":1616327517484},{"path":"D:\\data\\GoWorkSpace\\src\\github.com.qq4215279\\MyBlog\\frontend\\myblog-backstage\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\data\\GoWorkSpace\\src\\github.com.qq4215279\\MyBlog\\frontend\\myblog-backstage\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\data\\GoWorkSpace\\src\\github.com.qq4215279\\MyBlog\\frontend\\myblog-backstage\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKCi8qKg0KICog5YWo56uZaHR0cOmFjee9rg0KICoNCiAqIGF4aW9z5Y+C5pWw6K+05piODQogKiBpc1Rva2Vu5piv5ZCm6ZyA6KaBdG9rZW4NCiAqLwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOyAvLyBpbXBvcnQgc3RvcmUgZnJvbSAnQC9zdG9yZS8nOwovLyBpbXBvcnQgcm91dGVyIGZyb20gJ0Avcm91dGVyL2luZGV4JwoKaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICdAL3V0aWwvYXV0aCc7CmltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tICdlbGVtZW50LXVpJzsKaW1wb3J0IHdlYnNpdGUgZnJvbSAnQC9jb25maWcvd2Vic2l0ZSc7CmltcG9ydCBOUHJvZ3Jlc3MgZnJvbSAnbnByb2dyZXNzJzsgLy8gcHJvZ3Jlc3MgYmFyCgppbXBvcnQgJ25wcm9ncmVzcy9ucHJvZ3Jlc3MuY3NzJzsgLy8gcHJvZ3Jlc3MgYmFyIHN0eWxlCgp2YXIgc3RhdHVzV2hpdGVMaXN0ID0gd2Vic2l0ZS5zdGF0dXNXaGl0ZUxpc3QgfHwgW107CnZhciByZWZyZXNoTG9jayA9IGZhbHNlOwoKdmFyIHJlZnJlc2hUb2tlbiA9IGZ1bmN0aW9uIHJlZnJlc2hUb2tlbigpIHsKICByZXR1cm4gYXhpb3MoKTsKfTsKCnZhciByZXF1ZXN0TGlzdCA9IFtdOwpheGlvcy5kZWZhdWx0cy50aW1lb3V0ID0gMTAwMDA7IC8v6L+U5Zue5YW25LuW54q25oCB5ZCXCgpheGlvcy5kZWZhdWx0cy52YWxpZGF0ZVN0YXR1cyA9IGZ1bmN0aW9uIChzdGF0dXMpIHsKICByZXR1cm4gc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPD0gNTAwOyAvLyDpu5jorqTnmoQKfTsgLy/ot6jln5/or7fmsYLvvIzlhYHorrjkv53lrZhjb29raWUKCgpheGlvcy5kZWZhdWx0cy53aXRoQ3JlZGVudGlhbHMgPSB0cnVlOyAvL0hUVFByZXF1ZXN05oum5oiqCgpheGlvcy5pbnRlcmNlcHRvcnMucmVxdWVzdC51c2UoZnVuY3Rpb24gKGNvbmZpZykgewogIE5Qcm9ncmVzcy5zdGFydCgpOyAvLyBzdGFydCBwcm9ncmVzcyBiYXIKCiAgdmFyIG1ldGEgPSBjb25maWcubWV0YSB8fCB7fTsKICB2YXIgaXNUb2tlbiA9IG1ldGEuaXNUb2tlbiA9PT0gZmFsc2U7IC8vICAgY29uZmlnLmhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXSA9IGBCYXNpYyAke0Jhc2U2NC5lbmNvZGUoYCR7d2Vic2l0ZS5jbGllbnRJZH06JHt3ZWJzaXRlLmNsaWVudFNlY3JldH1gKX1gOwoKICBpZiAoZ2V0VG9rZW4oKSAmJiAhaXNUb2tlbikgewogICAgY29uZmlnLmhlYWRlcnNbJ0JsYWRlLUF1dGgnXSA9ICdiZWFyZXIgJyArIGdldFRva2VuKCk7IC8vIOiuqeavj+S4quivt+axguaQuuW4pnRva2VuLS1bJ0F1dGhvcml6YXRpb24nXeS4uuiHquWumuS5iWtleSDor7fmoLnmja7lrp7pmYXmg4XlhrXoh6rooYzkv67mlLkKICB9CgogIHJldHVybiBjb25maWc7Cn0sIGZ1bmN0aW9uIChlcnJvcikgewogIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7Cn0pOyAvL0hUVFByZXNwb25zZeaLpuaIqgoKYXhpb3MuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzKSB7CiAgTlByb2dyZXNzLmRvbmUoKTsKICB2YXIgc3RhdHVzID0gcmVzLmRhdGEuY29kZSB8fCAyMDA7CiAgdmFyIG1lc3NhZ2UgPSByZXMuZGF0YS5tc2cgfHwgJ+acquefpemUmeivryc7CiAgdmFyIGNvbmZpZyA9IHJlcy5jb25maWc7IC8v5aaC5p6c5Zyo55m95ZCN5Y2V6YeM5YiZ6Ieq6KGMY2F0Y2jpgLvovpHlpITnkIYKCiAgaWYgKHN0YXR1c1doaXRlTGlzdC5pbmNsdWRlcyhzdGF0dXMpKSByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzKTsgLy/lpoLmnpzmmK80MDHliJnml6DmhJ/liLfmlrB0b2tlbgoKICBpZiAoc3RhdHVzID09PSA0MDEpIHsKICAgIC8v5Yi35paw5LitCiAgICBpZiAoIXJlZnJlc2hMb2NrKSB7CiAgICAgIHJlZnJlc2hMb2NrID0gdHJ1ZTsKICAgICAgcmVmcmVzaFRva2VuKCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgdmFyIHRva2VuID0gcmVzLmRhdGEudG9rZW47CiAgICAgICAgcmVxdWVzdExpc3QuZm9yRWFjaChmdW5jdGlvbiAoZm4pIHsKICAgICAgICAgIGZuKHRva2VuKTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlcykgewogICAgICAgIC8v5Yi35paw5aSx6LSlCiAgICAgICAgY29uc29sZS5lcnJvcigncmVmcmVzaHRva2VuIGVycm9yID0+JywgcmVzKTsKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvJzsKICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVmcmVzaExvY2sgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgIHJlcXVlc3RMaXN0LnB1c2goZnVuY3Rpb24gKHRva2VuKSB7CiAgICAgICAgY29uZmlnLmJhc2VVUkwgPSAnJzsKICAgICAgICBjb25maWcuaGVhZGVyc1snQmxhZGUtQXV0aCddID0gdG9rZW47CiAgICAgICAgcmVzb2x2ZShheGlvcyhjb25maWcpKTsKICAgICAgfSk7CiAgICB9KTsKICB9IC8vIOWmguaenOivt+axguS4uumdnjIwMOWQpuiAhem7mOiupOe7n+S4gOWkhOeQhgoKCiAgaWYgKHN0YXR1cyAhPT0gMjAwKSB7CiAgICBNZXNzYWdlKHsKICAgICAgbWVzc2FnZTogbWVzc2FnZSwKICAgICAgdHlwZTogJ2Vycm9yJwogICAgfSk7CiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKG1lc3NhZ2UpKTsKICB9CgogIHJldHVybiByZXM7Cn0sIGZ1bmN0aW9uIChlcnJvcikgewogIE5Qcm9ncmVzcy5kb25lKCk7CiAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihlcnJvcikpOwp9KTsKZXhwb3J0IGRlZmF1bHQgYXhpb3M7"},{"version":3,"sources":["D:/data/GoWorkSpace/src/github.com.qq4215279/MyBlog/frontend/myblog-backstage/src/router/request.js"],"names":["axios","getToken","Message","website","NProgress","statusWhiteList","refreshLock","refreshToken","requestList","defaults","timeout","validateStatus","status","withCredentials","interceptors","request","use","config","start","meta","isToken","headers","error","Promise","reject","response","res","done","data","code","message","msg","includes","then","token","forEach","fn","catch","console","window","location","href","finally","resolve","push","baseURL","type","Error"],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,KAAP,MAAkB,OAAlB,C,CACA;AACA;;AACA,SAAQC,QAAR,QAAuB,aAAvB;AACA,SAAQC,OAAR,QAAsB,YAAtB;AACA,OAAOC,OAAP,MAAoB,kBAApB;AACA,OAAOC,SAAP,MAAsB,WAAtB,C,CAAkC;;AAClC,OAAO,yBAAP,C,CAAiC;;AAEjC,IAAMC,eAAe,GAAGF,OAAO,CAACE,eAAR,IAA2B,EAAnD;AAEA,IAAIC,WAAW,GAAG,KAAlB;;AACA,IAAIC,YAAY,GAAG,SAAfA,YAAe,GAAU;AAAC,SAAOP,KAAK,EAAZ;AAAe,CAA7C;;AACA,IAAIQ,WAAW,GAAG,EAAlB;AAEAR,KAAK,CAACS,QAAN,CAAeC,OAAf,GAAyB,KAAzB,C,CACA;;AACAV,KAAK,CAACS,QAAN,CAAeE,cAAf,GAAgC,UAAUC,MAAV,EAAkB;AAChD,SAAOA,MAAM,IAAI,GAAV,IAAiBA,MAAM,IAAI,GAAlC,CADgD,CACT;AACxC,CAFD,C,CAGA;;;AACAZ,KAAK,CAACS,QAAN,CAAeI,eAAf,GAAiC,IAAjC,C,CAEA;;AACAb,KAAK,CAACc,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CAA+B,UAAAC,MAAM,EAAI;AACvCb,EAAAA,SAAS,CAACc,KAAV,GADuC,CACrB;;AAClB,MAAMC,IAAI,GAAIF,MAAM,CAACE,IAAP,IAAe,EAA7B;AACA,MAAMC,OAAO,GAAGD,IAAI,CAACC,OAAL,KAAiB,KAAjC,CAHuC,CAIzC;;AACE,MAAInB,QAAQ,MAAM,CAACmB,OAAnB,EAA4B;AAC1BH,IAAAA,MAAM,CAACI,OAAP,CAAe,YAAf,IAA+B,YAAYpB,QAAQ,EAAnD,CAD0B,CAC4B;AACvD;;AACD,SAAOgB,MAAP;AACD,CATD,EASG,UAAAK,KAAK,EAAI;AACV,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CAXD,E,CAYA;;AACAtB,KAAK,CAACc,YAAN,CAAmBW,QAAnB,CAA4BT,GAA5B,CAAgC,UAAAU,GAAG,EAAI;AACrCtB,EAAAA,SAAS,CAACuB,IAAV;AACA,MAAMf,MAAM,GAAGc,GAAG,CAACE,IAAJ,CAASC,IAAT,IAAiB,GAAhC;AACA,MAAMC,OAAO,GAAGJ,GAAG,CAACE,IAAJ,CAASG,GAAT,IAAgB,MAAhC;AACA,MAAMd,MAAM,GAAGS,GAAG,CAACT,MAAnB,CAJqC,CAKrC;;AACA,MAAIZ,eAAe,CAAC2B,QAAhB,CAAyBpB,MAAzB,CAAJ,EAAsC,OAAOW,OAAO,CAACC,MAAR,CAAeE,GAAf,CAAP,CAND,CAOrC;;AACA,MAAId,MAAM,KAAK,GAAf,EAAoB;AAChB;AACA,QAAG,CAACN,WAAJ,EAAgB;AACdA,MAAAA,WAAW,GAAG,IAAd;AACAC,MAAAA,YAAY,GAAG0B,IAAf,CAAoB,UAACP,GAAD,EAAO;AAAA,YACjBQ,KADiB,GACPR,GAAG,CAACE,IADG,CACjBM,KADiB;AAEzB1B,QAAAA,WAAW,CAAC2B,OAAZ,CAAoB,UAACC,EAAD,EAAM;AACxBA,UAAAA,EAAE,CAACF,KAAD,CAAF;AACD,SAFD;AAGD,OALD,EAMCG,KAND,CAMO,UAAAX,GAAG,EAAI;AACZ;AACAY,QAAAA,OAAO,CAAChB,KAAR,CAAc,uBAAd,EAAuCI,GAAvC;AACAa,QAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,GAAvB;AACD,OAVD,EAUGC,OAVH,CAUW,YAAM;AACfpC,QAAAA,WAAW,GAAG,KAAd;AACD,OAZD;AAaD;;AACD,WAAO,IAAIiB,OAAJ,CAAY,UAACoB,OAAD,EAAW;AAC5BnC,MAAAA,WAAW,CAACoC,IAAZ,CAAiB,UAACV,KAAD,EAAS;AACxBjB,QAAAA,MAAM,CAAC4B,OAAP,GAAiB,EAAjB;AACA5B,QAAAA,MAAM,CAACI,OAAP,CAAe,YAAf,IAA+Ba,KAA/B;AACAS,QAAAA,OAAO,CAAC3C,KAAK,CAACiB,MAAD,CAAN,CAAP;AACD,OAJD;AAKD,KANM,CAAP;AAOD,GAjCkC,CAkCrC;;;AACA,MAAIL,MAAM,KAAK,GAAf,EAAoB;AAClBV,IAAAA,OAAO,CAAC;AACN4B,MAAAA,OAAO,EAAEA,OADH;AAENgB,MAAAA,IAAI,EAAE;AAFA,KAAD,CAAP;AAIA,WAAOvB,OAAO,CAACC,MAAR,CAAe,IAAIuB,KAAJ,CAAUjB,OAAV,CAAf,CAAP;AACD;;AACD,SAAOJ,GAAP;AACD,CA3CD,EA2CG,UAAAJ,KAAK,EAAI;AACVlB,EAAAA,SAAS,CAACuB,IAAV;AACA,SAAOJ,OAAO,CAACC,MAAR,CAAe,IAAIuB,KAAJ,CAAUzB,KAAV,CAAf,CAAP;AACD,CA9CD;AAgDA,eAAetB,KAAf","sourcesContent":["/**\r\n * 全站http配置\r\n *\r\n * axios参数说明\r\n * isToken是否需要token\r\n */\r\nimport axios from 'axios'\r\n// import store from '@/store/';\r\n// import router from '@/router/index'\r\nimport {getToken} from '@/util/auth'\r\nimport {Message} from 'element-ui'\r\nimport website from '@/config/website';\r\nimport NProgress from 'nprogress' // progress bar\r\nimport 'nprogress/nprogress.css' // progress bar style\r\n\r\nconst statusWhiteList = website.statusWhiteList || [];\r\n\r\nlet refreshLock = false;\r\nlet refreshToken = function(){return axios()};\r\nlet requestList = []\r\n\r\naxios.defaults.timeout = 10000;\r\n//返回其他状态吗\r\naxios.defaults.validateStatus = function (status) {\r\n  return status >= 200 && status <= 500; // 默认的\r\n};\r\n//跨域请求，允许保存cookie\r\naxios.defaults.withCredentials = true;\r\n\r\n//HTTPrequest拦截\r\naxios.interceptors.request.use(config => {\r\n  NProgress.start() // start progress bar\r\n  const meta = (config.meta || {});\r\n  const isToken = meta.isToken === false;\r\n//   config.headers['Authorization'] = `Basic ${Base64.encode(`${website.clientId}:${website.clientSecret}`)}`;\r\n  if (getToken() && !isToken) {\r\n    config.headers['Blade-Auth'] = 'bearer ' + getToken() // 让每个请求携带token--['Authorization']为自定义key 请根据实际情况自行修改\r\n  }\r\n  return config\r\n}, error => {\r\n  return Promise.reject(error)\r\n});\r\n//HTTPresponse拦截\r\naxios.interceptors.response.use(res => {\r\n  NProgress.done();\r\n  const status = res.data.code || 200\r\n  const message = res.data.msg || '未知错误';\r\n  const config = res.config;\r\n  //如果在白名单里则自行catch逻辑处理\r\n  if (statusWhiteList.includes(status)) return Promise.reject(res);\r\n  //如果是401则无感刷新token\r\n  if (status === 401) {\r\n      //刷新中\r\n      if(!refreshLock){\r\n        refreshLock = true\r\n        refreshToken().then((res)=>{\r\n          const { token } = res.data\r\n          requestList.forEach((fn)=>{\r\n            fn(token)\r\n          })\r\n        })\r\n        .catch(res => {\r\n          //刷新失败\r\n          console.error('refreshtoken error =>', res)\r\n          window.location.href = '/'\r\n        }).finally(() => {\r\n          refreshLock = false\r\n        })\r\n      }\r\n      return new Promise((resolve)=>{\r\n        requestList.push((token)=>{\r\n          config.baseURL = ''\r\n          config.headers['Blade-Auth'] = token\r\n          resolve(axios(config))\r\n        })\r\n      })\r\n    }\r\n  // 如果请求为非200否者默认统一处理\r\n  if (status !== 200) {\r\n    Message({\r\n      message: message,\r\n      type: 'error'\r\n    })\r\n    return Promise.reject(new Error(message))\r\n  }\r\n  return res;\r\n}, error => {\r\n  NProgress.done();\r\n  return Promise.reject(new Error(error));\r\n})\r\n\r\nexport default axios;\r\n"]}]}